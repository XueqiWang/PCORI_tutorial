############################################################################################################
# 
# This file corresponds to Case Study 2 of the manuscript entitled:
# "Analysis of cross-sectional stepped-wedge cluster randomized trials: A tutorial using marginal models"
# by EL Turner, J Preisser, Y Zhang, X Wang, M. Toles, S. Cykert, F. Li and P. Rathouz 
# 
# More specifically, this file includes the following:
# 1. Imports a deidentified aggregated data set for cluster-period analysis of the 
#    "screened for smoking" variable of the Heart Health Now stepped-wedge cluster randomized trial. 
# 2. Processes the data to derive relevant variables
# 3. Provides code to obtain some key descriptive statistics for the cluster-period analysis of the outcome of 
#    "screened for smoking (yes/no)". These descriptive statistics include sequence-period, cluster-period sumamries
#    of both the outcome as well as the denominator.
# 
# Note that the data set imported using the code below includes data from the 217 clusters (practices)
# 
############################################################################################################


##################################################################
# Packages needed
##################################################################


library(openxlsx)
library(dplyr)
library(ggplot2)

# Set working directory where data set is stored e.g. using the following command
# setwd("Data file")

##################################################################
# Screened for Smoking
##################################################################

HHN_smoking_screened_c <- read.xlsx("HHN_smoking_screened_c.xlsx", colNames=TRUE)

# Check that the data set has 2229 rows and 6 variables, specifically:

# 1. site_id: a numeric variable ranging from 1 to 217 that indexes the 217 practices (i.e. clusters) that provide data for
# 
# 2. quarter
# 3. cohort
# 4. phase
# 5. smoking_screened_num
# 6. smoking_screened_denom


dim(HHN_smoking_screened_c)

# responses
HHN_smoking_screened_c$y <- HHN_smoking_screened_c$smoking_screened_num/HHN_smoking_screened_c$smoking_screened_denom

# period identifier
HHN_smoking_screened_c$period <- as.numeric(factor(HHN_smoking_screened_c$quarter))

# make wide data
HHN_smoking_screened_w <- reshape(HHN_smoking_screened_c[, c("site_id", "period", "y")], idvar = "site_id", timevar = "period", direction = "wide")

# correlation matrix
res_cor <- cor(HHN_smoking_screened_w[, -1], use = "complete.obs")
round(res_cor, 3)
#        y.1   y.2   y.3   y.4   y.5   y.6   y.7   y.8   y.9  y.10  y.11
# y.1  1.000 0.964 0.909 0.834 0.790 0.743 0.660 0.613 0.552 0.509 0.489
# y.2  0.964 1.000 0.967 0.896 0.857 0.813 0.731 0.687 0.622 0.572 0.550
# y.3  0.909 0.967 1.000 0.950 0.918 0.874 0.783 0.740 0.672 0.615 0.590
# y.4  0.834 0.896 0.950 1.000 0.983 0.944 0.852 0.816 0.759 0.703 0.679
# y.5  0.790 0.857 0.918 0.983 1.000 0.982 0.907 0.875 0.822 0.768 0.745
# y.6  0.743 0.813 0.874 0.944 0.982 1.000 0.963 0.933 0.886 0.836 0.815
# y.7  0.660 0.731 0.783 0.852 0.907 0.963 1.000 0.983 0.947 0.902 0.883
# y.8  0.613 0.687 0.740 0.816 0.875 0.933 0.983 1.000 0.982 0.943 0.927
# y.9  0.552 0.622 0.672 0.759 0.822 0.886 0.947 0.982 1.000 0.984 0.974
# y.10 0.509 0.572 0.615 0.703 0.768 0.836 0.902 0.943 0.984 1.000 0.997
# y.11 0.489 0.550 0.590 0.679 0.745 0.815 0.883 0.927 0.974 0.997 1.000


# data for pairwise comparison
HHN_smoking_screened_c$trt <- as.numeric(HHN_smoking_screened_c$phase > 0)
HHN_smoking_screened_c$tp <- HHN_smoking_screened_c$cohort
HHN_smoking_screened_c$tp[HHN_smoking_screened_c$cohort >= 4] <- HHN_smoking_screened_c$tp[HHN_smoking_screened_c$cohort >= 4] - 1

HHN_smoking_screened_c$lag <- HHN_smoking_screened_c$period - HHN_smoking_screened_c$tp

HHN_smoking_screened_p <- subset(HHN_smoking_screened_c, HHN_smoking_screened_c$period ==1 | HHN_smoking_screened_c$trt == 1)
HHN_smoking_screened_p$lag[HHN_smoking_screened_p$lag < 0] <- 0

HHN_smoking_screened_pw <- reshape(HHN_smoking_screened_p[, c("site_id", "lag", "y")], idvar = "site_id", timevar = "lag", direction = "wide")
HHN_smoking_screened_pw <- subset(HHN_smoking_screened_pw, HHN_smoking_screened_pw$y.0 != "NA") 
trt_lag <- colMeans(HHN_smoking_screened_pw[, 3:12] - HHN_smoking_screened_pw[, 2], na.rm = TRUE)
names(trt_lag) <- c("lag.1", "lag2", "lag3", "lag4", "lag5", "lag6", "lag7", "lag8", "lag9", "lag10")
round(trt_lag, 3)
# lag.1   lag2   lag3   lag4   lag5   lag6   lag7   lag8   lag9  lag10 
# 0.030  0.041  0.042  0.033  0.018  0.004  0.003 -0.054 -0.100 -0.097 


##################################################################
# Descriptive Statistics
##################################################################
data_summary_y <- HHN_smoking_screened_c %>%
  group_by(cohort, period) %>%
  summarize(min = min(y),
            q1 = quantile(y, 0.25),
            median = median(y),
            mean = mean(y),
            q3 = quantile(y, 0.75),
            max = max(y)) %>%
  as.data.frame()
data_summary_y
#    cohort period         min         q1    median      mean        q3       max
# 1       1      1 0.084848485 0.87821814 0.9225814 0.7836162 0.9627613 1.0000000
# 2       1      2 0.089188322 0.83524904 0.9043977 0.7837858 0.9523810 1.0000000
# 3       1      3 0.088782051 0.85597826 0.9325967 0.8032489 0.9703896 1.0000000
# 4       1      4 0.084635417 0.87317518 0.9313861 0.8059287 0.9685039 1.0000000
# 5       1      5 0.085218469 0.85774947 0.9194401 0.7962589 0.9387008 1.0000000
# 6       1      6 0.083461184 0.78674613 0.8843955 0.7617676 0.9350124 0.9965035
# 7       1      7 0.080420662 0.72278390 0.8337240 0.7467703 0.9195029 0.9918218
# 8       1      8 0.059616749 0.66224337 0.8100833 0.7189042 0.8704582 0.9804119
# 9       1      9 0.063480742 0.63021956 0.7723536 0.6993787 0.8553194 0.9720339
# 10      1     10 0.057686005 0.64764890 0.7352941 0.6733662 0.7914786 0.9767687
# 11      1     11 0.054753107 0.64526613 0.7231109 0.6604635 0.7692420 0.9779180
# 12      2      1 0.070937004 0.43481902 0.7960644 0.6797903 0.9423636 1.0000000
# 13      2      2 0.072440945 0.40102102 0.7759857 0.6555049 0.9416232 1.0000000
# 14      2      3 0.076480736 0.37750713 0.7728938 0.6474746 0.9363773 1.0000000
# 15      2      4 0.071756602 0.35322858 0.7299893 0.6494334 0.9215845 1.0000000
# 16      2      5 0.072683222 0.43121703 0.7064018 0.6544717 0.9140276 1.0000000
# 17      2      6 0.074346405 0.34828496 0.7338195 0.6257061 0.8555556 1.0000000
# 18      2      7 0.078488372 0.32729742 0.6728216 0.5767972 0.8058820 0.9560440
# 19      2      8 0.072319202 0.29710647 0.6180357 0.5340582 0.7582512 0.9460946
# 20      2      9 0.099495798 0.35083227 0.5978444 0.5362170 0.7074663 0.9373695
# 21      2     10 0.090215128 0.40277778 0.5816398 0.5596793 0.7632743 0.9449113
# 22      2     11 0.081346424 0.39785832 0.5963489 0.5552788 0.7574371 0.9515695
# 23      3      1 0.000000000 0.15369304 0.5494820 0.5019446 0.8712580 0.9989589
# 24      3      2 0.000000000 0.11766170 0.5589383 0.4982573 0.8450540 0.9986720
# 25      3      3 0.000000000 0.12086909 0.5489117 0.5025326 0.8652869 0.9986698
# 26      3      4 0.000000000 0.15632661 0.5180372 0.5152574 0.8880284 0.9979960
# 27      3      5 0.004145078 0.13653154 0.5587432 0.5185741 0.8573453 0.9977401
# 28      3      6 0.005841742 0.12944059 0.5464072 0.4911114 0.7667210 0.9773626
# 29      3      7 0.008898776 0.11864407 0.5263158 0.4796396 0.7261307 0.9539602
# 30      3      8 0.009158558 0.09030928 0.4449153 0.4516724 0.7297297 0.9257239
# 31      3      9 0.011309524 0.11965579 0.4305994 0.4366992 0.7306457 0.8958774
# 32      3     10 0.011117974 0.07454478 0.5172326 0.4381479 0.7109437 0.8672394
# 33      3     11 0.010455105 0.07457249 0.5133158 0.4324962 0.6998516 0.8603604
# 34      4      1 0.058772185 0.17664671 0.3470226 0.4719064 0.9054622 1.0000000
# 35      4      2 0.065085334 0.18119068 0.3703704 0.4970829 0.9033352 1.0000000
# 36      4      3 0.070761015 0.17410938 0.4215397 0.4840646 0.8612867 0.9977553
# 37      4      4 0.076484561 0.27420045 0.5445881 0.5699127 0.9140278 1.0000000
# 38      4      5 0.077426080 0.25804023 0.5618812 0.5633212 0.9181009 1.0000000
# 39      4      6 0.076214734 0.25070658 0.5471195 0.5530307 0.9223354 1.0000000
# 40      4      7 0.067415730 0.22957348 0.4596760 0.5299631 0.8873791 1.0000000
# 41      4      8 0.072639541 0.25183036 0.5726141 0.5397770 0.8330640 1.0000000
# 42      4      9 0.071101418 0.24556530 0.5795918 0.5207886 0.7834438 1.0000000
# 43      4     10 0.033333333 0.26216356 0.5488283 0.5124863 0.7814808 1.0000000
# 44      4     11 0.033333333 0.23712564 0.3852201 0.4607642 0.6343423 0.9650960
# 45      5      1 0.024390244 0.06386419 0.4346902 0.4242889 0.6193366 0.9983029
# 46      5      2 0.023411371 0.09843194 0.5096033 0.4595247 0.7827328 0.9979244
# 47      5      3 0.031315240 0.09711957 0.6275219 0.4969744 0.8712854 0.9975718
# 48      5      4 0.036548223 0.11250120 0.7080615 0.5509451 0.9232763 1.0000000
# 49      5      5 0.044510386 0.19095796 0.7325160 0.5744827 0.9181767 0.9994018
# 50      5      6 0.049760766 0.18698500 0.7679881 0.5965140 0.9352149 0.9794146
# 51      5      7 0.051987768 0.19745302 0.8716351 0.6306999 0.9480016 1.0000000
# 52      5      8 0.043613707 0.21395706 0.8444444 0.6292268 0.9387255 1.0000000
# 53      5      9 0.055718475 0.22507669 0.8494354 0.6323773 0.9444263 1.0000000
# 54      5     10 0.057065217 0.23169108 0.8605540 0.6280443 0.9527508 1.0000000
# 55      5     11 0.054794521 0.24095127 0.7561787 0.6030011 0.9566881 0.9946309
# 56      6      1 0.041833282 0.38923646 0.7142857 0.6437184 0.9514706 0.9914255
# 57      6      2 0.044376900 0.37074275 0.7216138 0.6478064 0.9585858 1.0000000
# 58      6      3 0.025000000 0.37265439 0.7477944 0.6559801 0.9606385 1.0000000
# 59      6      4 0.000000000 0.39311044 0.8388702 0.6667541 0.9574468 0.9966330
# 60      6      5 0.067186563 0.39943873 0.7982906 0.6713551 0.9505041 0.9965458
# 61      6      6 0.068002340 0.45469989 0.8038842 0.6832659 0.9622713 0.9982487
# 62      6      7 0.071594203 0.47937800 0.8695008 0.7052134 0.9690886 1.0000000
# 63      6      8 0.074754711 0.48011816 0.8033753 0.6974065 0.9720574 1.0000000
# 64      6      9 0.074652778 0.44263607 0.7695141 0.6933626 0.9668817 1.0000000
# 65      6     10 0.080728376 0.40397351 0.7936094 0.6857884 0.9717776 1.0000000
# 66      6     11 0.081091322 0.38192456 0.6251480 0.6537569 0.9629447 1.0000000

data_summary_denom <- HHN_smoking_screened_c %>%
  group_by(cohort, period) %>%
  summarize(min = min(smoking_screened_denom),
            q1 = quantile(smoking_screened_denom, 0.25),
            median = median(smoking_screened_denom),
            mean = mean(smoking_screened_denom),
            q3 = quantile(smoking_screened_denom, 0.75),
            max = max(smoking_screened_denom)) %>%
  as.data.frame()
data_summary_denom
#    cohort period min      q1 median     mean      q3   max
# 1       1      1   1  878.25 1647.0 2075.125 2774.50  6980
# 2       1      2   1 1046.00 1951.0 2171.788 2972.00  6984
# 3       1      3   4 1104.00 1925.0 2242.939 3120.00  7150
# 4       1      4  82 1096.00 1962.0 2253.424 2945.00  7147
# 5       1      5  71 1056.00 1765.0 2150.939 2741.00  7116
# 6       1      6  67 1027.75 1970.0 2249.500 3061.00  7053
# 7       1      7  49  986.25 1884.5 2133.767 2584.50  6925
# 8       1      8  34  952.75 1660.0 2005.300 2220.25  6920
# 9       1      9  15  708.25 1391.0 1913.700 2310.00  6989
# 10      1     10 175  913.50 1500.0 2025.111 2294.50  6950
# 11      1     11  32  895.50 1500.0 1991.370 2267.50  6953
# 12      2      1   4  590.00  979.0 1463.556 1804.00  5827
# 13      2      2   3  763.50 1006.0 1514.593 1778.50  5768
# 14      2      3  11  835.50 1018.0 1515.852 1702.50  5607
# 15      2      4  11  742.00 1052.0 1545.963 1713.50  5540
# 16      2      5   8  809.00 1033.0 1513.778 1688.50  5555
# 17      2      6   8  769.00 1074.0 1405.320 1516.00  5467
# 18      2      7 174  783.25 1013.5 1302.542 1579.25  4647
# 19      2      8 173  461.25  911.0 1112.125 1243.25  3406
# 20      2      9  14  488.00  988.0 1147.381 1396.00  2975
# 21      2     10 158  611.00 1071.0 1204.714 1427.00  3332
# 22      2     11 146  437.00 1115.0 1178.952 1479.00  3389
# 23      3      1   4  296.75 1358.0 1981.267 2811.50  9804
# 24      3      2   5  365.75 1345.0 1994.733 2857.25  9818
# 25      3      3   3  407.25 1336.5 1962.400 2837.00  9968
# 26      3      4   8  400.50 1335.5 1880.200 2322.25 10014
# 27      3      5 205  572.50 1190.5 1842.033 2305.75 10127
# 28      3      6 186  500.00 1181.0 1843.345 2075.00 10170
# 29      3      7  95  437.00 1082.0 1731.069 1949.00  9909
# 30      3      8  45  466.00 1077.0 1776.828 2383.00  9957
# 31      3      9  35  513.50 1178.0 1869.185 2419.50 10185
# 32      3     10 321  851.75 1281.5 2141.182 2524.00 10248
# 33      3     11 294  825.00 1277.5 2117.955 2354.50 10254
# 34      4      1   1  431.00  937.0 1530.364 1608.00 10311
# 35      4      2   1  537.00  963.0 1595.000 1669.00 10371
# 36      4      3  19  632.75 1030.5 1736.531 1838.75 10486
# 37      4      4 180  691.50 1143.5 1783.265 1745.00 10525
# 38      4      5 202  753.75 1096.5 1819.176 1711.50 10552
# 39      4      6 218  696.50 1120.5 1767.588 1623.50 10208
# 40      4      7  89  625.75 1057.0 1620.912 1605.75  8747
# 41      4      8 241  687.50 1111.0 1702.065 1695.00  7668
# 42      4      9  38  653.50 1075.0 1572.194 2021.50  5322
# 43      4     10  30  627.25  939.5 1462.133 1791.50  5162
# 44      4     11  30  600.00 1123.0 1512.889 1999.50  5185
# 45      5      1 287  874.50 1231.5 2056.400 2603.75  9788
# 46      5      2   9  634.50 1170.0 1976.125 2655.00  9599
# 47      5      3 311  833.25 1319.5 2093.938 2808.75  9637
# 48      5      4 312  852.50 1288.0 2221.382 2859.00  9692
# 49      5      5 306  900.50 1318.5 2279.324 2781.75  9808
# 50      5      6 298  872.00 1449.0 2260.882 2843.25  9756
# 51      5      7 281  922.00 1494.5 2208.471 2850.25  8801
# 52      5      8 289  935.00 1625.0 2241.394 2835.00  8441
# 53      5      9 240  851.00 1562.0 2215.182 2783.00  8389
# 54      5     10 165  688.00 1512.0 2114.303 2761.00  8383
# 55      5     11 144  634.50 1498.0 2123.613 2847.50  8219
# 56      6      1   7  355.00 1122.0 1754.936 2194.50 10311
# 57      6      2   8  432.75 1021.0 1783.354 2137.00 10444
# 58      6      3  10  459.75  944.5 1757.180 2275.25 10633
# 59      6      4   1  532.00 1030.0 1713.772 2092.00 10672
# 60      6      5  72  579.00 1091.0 1806.877 2435.00 10813
# 61      6      6  86  624.00 1268.0 1869.614 2468.00 10948
# 62      6      7   1  635.25 1241.5 1858.207 2352.00 10350
# 63      6      8   3  671.75 1262.0 1837.155 2371.25  9856
# 64      6      9   4  682.50 1258.0 1819.724 2409.50  9272
# 65      6     10   3  661.00 1214.0 1788.439 2374.00  8838
# 66      6     11   3  633.75 1209.0 1646.846 2328.75  8457

summary(HHN_smoking_screened_c$smoking_screened_denom)
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#   1     622    1217    1843    2497   10948 

sum(HHN_smoking_screened_c$smoking_screened_denom<=11)
# 28
HHN_smoking_screened_c[HHN_smoking_screened_c$smoking_screened_denom<=11, ]


##################################################################
# More Descriptive Statistics
##################################################################
# number of clusters that provide data in at least one period
length(unique(HHN_smoking_screened_c$site_id))
# 217

# number of clusters that provide data in each period
HHN_smoking_screened_c %>% group_by(period) %>% tally()
# period     n
# <dbl> <int>
# 1      1   199
# 2      2   203
# 3      3   204
# 4      4   215
# 5      5   215
# 6      6   209
# 7      7   209
# 8      8   205
# 9      9   200
# 10     10   190
# 11     11   180

# number of periods with data for each cluster
period_total <- HHN_smoking_screened_c %>% 
  group_by(site_id) %>% tally() %>%
  as.data.frame()
period_total
#     site_id  n
# 1     NC103 11
# 2     NC104 11
# 3     NC115  7
# 4     NC125  7
# 5     NC134 11
# 6     NC135 11
# 7     NC136 11
# 8     NC137 11
# 9     NC138 11
# 10    NC143 11
# … with 207 more rows

# summary statistics in each sequence-period
# number: number of clusters with data in each sequence-period
# denom: total denominator in each sequence-period
# num: total numerator in each sequence-period
# prop: overall outcome proportion in each sequence-period
data_sequence_period <- HHN_smoking_screened_c %>%
  group_by(cohort, period) %>%
  summarize(phase = mean(phase),
            number = n(),
            denom = sum(smoking_screened_denom),
            num = sum(smoking_screened_num),
            prop = num/denom) %>%
  as.data.frame()
data_sequence_period 
#    cohort period phase number  denom   num      prop
# 1       1      1     0     32  66404 48293 0.7272604
# 2       1      2     1     33  71669 52424 0.7314739
# 3       1      3     1     33  74017 55524 0.7501520
# 4       1      4     1     33  74363 56273 0.7567339
# 5       1      5     1     33  70981 53531 0.7541596
# 6       1      6     2     30  67485 50030 0.7413499
# 7       1      7     2     30  64013 46627 0.7283989
# 8       1      8     2     30  60159 42243 0.7021892
# 9       1      9     2     30  57411 38882 0.6772570
# 10      1     10     2     27  54678 36026 0.6588756
# 11      1     11     2     27  53767 35010 0.6511429
# 12      2      1     0     27  39516 25845 0.6540389
# 13      2      2     0     27  40894 26031 0.6365481
# 14      2      3     1     27  40928 25544 0.6241204
# 15      2      4     1     27  41741 25239 0.6046573
# 16      2      5     1     27  40872 24368 0.5962028
# 17      2      6     1     25  35133 19620 0.5584493
# 18      2      7     2     24  31261 16232 0.5192412
# 19      2      8     2     24  26691 12534 0.4695965
# 20      2      9     2     21  24095 10653 0.4421249
# 21      2     10     2     21  25299 12947 0.5117594
# 22      2     11     2     21  24758 12756 0.5152274
# 23      3      1     0     30  59438 29129 0.4900737
# 24      3      2     0     30  59842 29137 0.4868988
# 25      3      3     0     30  58872 28195 0.4789204
# 26      3      4     1     30  56406 25412 0.4505194
# 27      3      5     1     30  55261 23478 0.4248566
# 28      3      6     1     29  53457 21532 0.4027910
# 29      3      7     1     29  50201 19483 0.3880998
# 30      3      8     2     29  51528 19416 0.3768048
# 31      3      9     2     27  50468 18628 0.3691052
# 32      3     10     2     22  47106 16883 0.3584044
# 33      3     11     2     22  46595 16495 0.3540079
# 34      4      1     0     33  50502 18007 0.3565601
# 35      4      2     0     33  52635 21575 0.4098984
# 36      4      3     0     32  55569 26050 0.4687866
# 37      4      4     1     34  60631 33534 0.5530834
# 38      4      5     1     34  61852 34318 0.5548406
# 39      4      6     1     34  60098 33182 0.5521315
# 40      4      7     1     34  55111 30463 0.5527572
# 41      4      8     2     31  52764 28342 0.5371465
# 42      4      9     2     31  48738 27144 0.5569371
# 43      4     10     2     30  43864 24507 0.5587042
# 44      4     11     2     27  40848 21124 0.5171367
# 45      5      1     0     30  61692 24328 0.3943461
# 46      5      2     0     32  63236 26741 0.4228762
# 47      5      3     0     32  67006 33792 0.5043130
# 48      5      4     0     34  75527 43785 0.5797265
# 49      5      5     1     34  77497 48226 0.6222951
# 50      5      6     1     34  76870 50847 0.6614674
# 51      5      7     1     34  75088 54134 0.7209408
# 52      5      8     1     33  73966 53505 0.7233729
# 53      5      9     2     33  73101 53914 0.7375275
# 54      5     10     2     33  69772 51113 0.7325718
# 55      5     11     2     31  65832 46962 0.7133613
# 56      6      1     0     47  82482 50546 0.6128125
# 57      6      2     0     48  85601 54638 0.6382869
# 58      6      3     0     50  87859 60878 0.6929057
# 59      6      4     0     57  97685 69845 0.7150023
# 60      6      5     0     57 102992 74685 0.7251534
# 61      6      6     1     57 106568 78629 0.7378294
# 62      6      7     1     58 107776 80756 0.7492948
# 63      6      8     1     58 106555 78450 0.7362395
# 64      6      9     1     58 105544 78070 0.7396915
# 65      6     10     2     57 101941 75396 0.7396043
# 66      6     11     2     52  85636 59692 0.6970433

# plot of overall outcome proportion in each sequence-period
cohort.labs <- c("Sequence 1", "Sequence 2", "Sequence 3", "Sequence 4", "Sequence 5", "Sequence 6")
names(cohort.labs) <- c("1", "2", "3", "4", "5", "6")
options(scipen=10000)
ggplot(data = data_sequence_period, aes(period, prop, colour = factor(phase))) +
  geom_line() + geom_point(aes(size = denom)) + 
  scale_color_manual(values = c("grey69", "slategray2", "cornflowerblue"),
                     labels = c("Control", "Intervention", "Maintenance"),
                     breaks = c("0", "1", "2")) +
  xlab("Period") + ylab("Outcome Proportion") +
  scale_y_continuous(limits = c(0.3, 0.8), breaks = seq(0.3, 0.8, 0.1)) +
  scale_x_continuous(breaks = seq(1, 11, 1)) +
  facet_wrap(~ cohort,  ncol=3, labeller = labeller(cohort = cohort.labs)) +
  theme_bw() +
  theme(legend.position="bottom", legend.direction = "horizontal", legend.box = "vertical") +
  guides(color = guide_legend(title = "Phase"),
         size = guide_legend(title = "Sequence-period size"))


